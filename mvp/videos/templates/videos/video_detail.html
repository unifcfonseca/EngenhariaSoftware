{% extends 'base.html' %}

{% block extra_head %}
<style>
    .video-container {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        max-width: 800px;
        margin: 0 auto;
    }

    h1 {
        color: #12205D;
    }

    video {
        width: 100%;
        border-radius: 10px;
        margin-top: 15px;
    }

    .reaction-buttons button {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        margin-right: 10px;
        transition: transform 0.2s ease;
    }

    .active {
        color: #006DAA;
        font-weight: bold;
        transform: scale(1.2);
    }

    .reaction-buttons button:hover {
        transform: scale(1.2);
    }

    .count {
        font-weight: bold;
        margin-right: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="video-container">
    <h1>{{ video.title }}</h1>
    <p><strong>Mat√©ria:</strong> {{ video.subject }}</p>

    {% if video.video_file %}
        <video controls>
            <source src="{{ video.video_file.url }}" type="video/mp4">
        </video>
    {% endif %}

    <p class="description">{{ video.description }}</p>

    <div class="reaction-buttons">
        <span class="count">üëç <span id="like-count">{{ video.likes }}</span></span>
        <span class="count">üëé <span id="dislike-count">{{ video.dislikes }}</span></span>

        {% if user.is_authenticated %}
            <button id="like-btn" class="{% if user_reaction == 'like' %}active{% endif %}">üëç</button>
            <button id="dislike-btn" class="{% if user_reaction == 'dislike' %}active{% endif %}">üëé</button>
        {% else %}
            <p><a href="{% url 'login' %}">Fa√ßa login</a> para reagir.</p>
        {% endif %}
    </div>

    <a href="{% url 'home' %}" class="btn">‚¨Ö Voltar</a>
</div>

{% if user.is_authenticated %}
<script>
function sendReaction(url) {
    fetch(url, {
        method: 'POST',
        headers: {'X-CSRFToken': '{{ csrf_token }}'}
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('like-count').textContent = data.likes;
        document.getElementById('dislike-count').textContent = data.dislikes;

        // Atualiza destaque
        const likeBtn = document.getElementById('like-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        if (url.includes('like')) {
            likeBtn.classList.toggle('active');
            dislikeBtn.classList.remove('active');
        } else {
            dislikeBtn.classList.toggle('active');
            likeBtn.classList.remove('active');
        }
    });
}

document.getElementById('like-btn').addEventListener('click', () => sendReaction("{% url 'like_video' video.id %}"));
document.getElementById('dislike-btn').addEventListener('click', () => sendReaction("{% url 'dislike_video' video.id %}"));
</script>
{% endif %}
{% endblock %}
