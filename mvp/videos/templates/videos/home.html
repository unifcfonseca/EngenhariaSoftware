{% extends 'base.html' %}

{% block extra_head %}
<style>
    .page-title {
        font-size: 1.8rem;
        color: #12205D;
        margin-bottom: 20px;
    }

    .filters-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        align-items: center;
    }

    .filters-bar input[type="text"],
    .filters-bar select {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 0.9rem;
    }

    .filters-bar button {
        padding: 8px 14px;
        background-color: #006DAA;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
    }

    .filters-bar button:hover {
        background-color: #004E7D;
    }

    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
    }

    .video-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow: hidden;
        transition: 0.2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .video-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .video-card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
    }

    .video-info {
        padding: 15px;
    }

    .video-info h3 {
        margin: 0;
        font-size: 1.2rem;
        color: #12205D;
    }

    .subject {
        background: #006DAA;
        color: white;
        display: inline-block;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 0.8rem;
        margin-top: 8px;
    }

    .description {
        font-size: 0.9rem;
        margin-top: 10px;
        color: #444;
    }

    .meta {
        font-size: 0.8rem;
        color: #666;
        margin-top: 8px;
    }

    .btn {
        display: inline-block;
        margin-top: 10px;
        background-color: #006DAA;
        color: white;
        padding: 6px 12px;
        border-radius: 8px;
        text-decoration: none;
        transition: 0.2s;
    }

    .btn:hover {
        background-color: #004E7D;
    }

    .pagination {
        text-align: center;
        margin-top: 25px;
    }

    .pagination a, .pagination span {
        display: inline-block;
        margin: 0 4px;
        padding: 6px 12px;
        border-radius: 6px;
        border: 1px solid #ccc;
        color: #12205D;
        text-decoration: none;
    }

    .pagination .current {
        background-color: #006DAA;
        color: white;
        border-color: #006DAA;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="page-title">üìö Aulas Dispon√≠veis</h1>
<hr>

<form method="get" class="filters-bar">
    <input type="text" name="q" placeholder="Buscar por nome, mat√©ria, professor ou universidade..." value="{{ query }}">
    
    <select name="filter">
        <option value="">Filtrar por...</option>
        {% for s in subjects %}
            <option value="{{ s }}" {% if s == selected_filter %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
        {% for u in universities %}
            <option value="{{ u }}" {% if u == selected_filter %}selected{% endif %}>{{ u }}</option>
        {% endfor %}
        {% for p in professors %}
            <option value="{{ p }}" {% if p == selected_filter %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
    </select>

    <select name="sort">
        <option value="date" {% if sort_option == 'date' %}selected{% endif %}>Data</option>
        <option value="title" {% if sort_option == 'title' %}selected{% endif %}>T√≠tulo</option>
        <option value="views" {% if sort_option == 'views' %}selected{% endif %}>Visualiza√ß√µes</option>
        <option value="likes" {% if sort_option == 'likes' %}selected{% endif %}>Likes</option>
    </select>

    <button type="submit">Aplicar</button>
</form>

<p><strong>{{ page_obj.paginator.count }}</strong> aulas encontradas</p>

<div class="video-grid">
{% for video in videos %}
    <div class="video-card">
        {% if video.thumbnail %}
            <img src="{{ video.thumbnail.url }}" alt="Thumbnail de {{ video.title }}">
        {% endif %}
        <div class="video-info">
            <h3>{{ video.title }}</h3>
            <p class="subject">{{ video.subject }}</p>
            <p class="description">{{ video.description|truncatewords:20 }}</p>
            <p class="meta">üëÄ {{ video.views }} | üëç {{ video.likes }} | üëé {{ video.dislikes }}</p>
            <p class="meta"><small>Postado por {{ video.uploaded_by.username }} em {{ video.created_at|date:"d/m/Y" }}</small></p>
            <a href="{% url 'video_detail' video.id %}" class="btn">Ver detalhes</a>
        </div>
    </div>
{% empty %}
    <p>Nenhuma aula dispon√≠vel.</p>
{% endfor %}
</div>

<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&q={{ query }}&filter={{ selected_filter }}&sort={{ sort_option }}">Anterior</a>
    {% endif %}
    <span class="current">P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&q={{ query }}&filter={{ selected_filter }}&sort={{ sort_option }}">Pr√≥xima</a>
    {% endif %}
</div>
{% endblock %}
